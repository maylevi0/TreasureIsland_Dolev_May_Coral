
@using TreasureIsland_Dolev_May_Coral.Shared.Entities
@inject HttpClient Http

<MudDialog>
    <DialogContent>
        <EditForm Model="@newGame" OnValidSubmit="OnValidSubmit">
            <DataAnnotationsValidator />
            <MudGrid>
                <MudItem Style="width: 400px; height:300px">
                    <MudTextField Variant="Variant.Outlined" Placeholder="הקלידו שם למשחק..." Label="שם משחק" HelperText="2-25 תווים" @onkeyup="statusButton"
                                  @bind-Value="newGame.GameName" For="@(() => newGame.GameName)" />

                    <MudSelect Variant="Variant.Outlined" T="int" Placeholder="@GameTime" Label="זמן מענה לשאלה" @bind-Value="newGame.QTimeLimit" For="@(() => newGame.QTimeLimit)" AnchorOrigin="Origin.BottomCenter">
                        <MudSelectItem T="int" Value="20">20 שניות</MudSelectItem>
                        <MudSelectItem T="int" Value="30">30 שניות</MudSelectItem>
                        <MudSelectItem T="int" Value="40">40 שניות</MudSelectItem>
                        <MudSelectItem T="int" Value="50">50 שניות</MudSelectItem>
                        <MudSelectItem T="int" Value="60">60 שניות</MudSelectItem>
                    </MudSelect>
                    @if (IsButtonEabled == true)
                    {
                        <MudButton Style="background-color:saddlebrown; color:azure" ButtonType="ButtonType.Submit" Color="Color.Primary" Disabled="true" Variant="Variant.Filled">צור משחק</MudButton>
                    }
                    else
                    {
                        <MudButton Style="background-color:saddlebrown; color:azure" ButtonType="ButtonType.Submit" Color="Color.Primary" Variant="Variant.Filled">צור משחק</MudButton>
                    }
                </MudItem>
            </MudGrid>
          
        </EditForm>
    </DialogContent>
    <DialogActions>
        <MudButton OnClick="Cancel">ביטול</MudButton>
    </DialogActions>
</MudDialog>


@code {

    [Parameter]
    public int userId { get; set; }  //נשלח מהדף פרמטר

    //יצירת מופע חדש של משחק
    Game newGame = new Game();

    string gameCurrentName = "";

    string GameTime = "בחרו זמן לשאלה";

    [CascadingParameter] MudDialogInstance MudDialog { get; set; }

    void Cancel() => MudDialog.Cancel();

    // כפתור צור משחק- בלחיצה על כפתור של הטופס צריך להפעיל קריאה למאגר נתונים
    protected async Task OnValidSubmit()
    {
        Console.WriteLine("userId " + userId);

        //   מאפיינים של מודל משחק חדש צריכים להיות מאוכלסים
        newGame.UserID = userId;

        //ואז קריאה לקונטרולר והוספת משחק

        var postRespone = await Http.PostAsJsonAsync("api/Games/", newGame);
        if (postRespone.IsSuccessStatusCode == true)
        {
            Console.WriteLine("נכנס לתנאי בדיאלוג ");

            Game AddGame = postRespone.Content.ReadFromJsonAsync<Game>().Result;

            //איפוס המופע לאפשר יצירת מופע חדש
            newGame = new Game();

            // CurrentUser = new User();

            MudDialog.Close(DialogResult.Ok(true));
        }
        else
        {
            Console.WriteLine("לא בוצעו שינויים תקלה בקריאה");

            MudDialog.Close(DialogResult.Ok(false));

        }
    }

    bool IsButtonEabled = true;

    void statusButton()
    {
        StateHasChanged();
        if (string.IsNullOrEmpty(newGame.GameName) == false)
        {
            IsButtonEabled = true;
            StateHasChanged();
        }
        else
        {
            IsButtonEabled = false;
            StateHasChanged();

        }

    }
}
